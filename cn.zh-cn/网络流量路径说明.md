# 网络流量路径说明<a name="zh-cn_topic_0166333709"></a>

负载均衡将来自客户端的请求通过负载均衡器分发至后端服务器，后端服务器再将响应通过内网返回给负载均衡。负载均衡器和后端服务器之间是通过内网进行通信的。

-   如果负载均衡器后端服务器仅处理来自负载均衡的访问请求，服务器可以不购买EIP或者NAT网关等服务，仅有私网IP即可。
-   如果负载均衡器后端服务器还需要直接对公网提供服务，或者需要访问公网资源，则服务器需要购买EIP或者NAT网关等服务。

## 入网流量路径<a name="section12884538197"></a>

对于入网流量，负载均衡会根据用户配置的流量分配策略，对来自公网或者私网的访问请求进行转发和处理。如[图1](#fig1920512561518)所示。

**图 1**  入网流量路径<a name="fig1920512561518"></a>  
![](figures/入网流量路径.png "入网流量路径")

当负载均衡器使用四层协议TCP/UDP时：

-   四层协议TCP/UDP的流量只经过LVS集群进行转发。
-   LVS集群的所有节点会根据负载均衡器的流量分配策略，将接收到的访问请求直接分发到后端服务器。

当负载均衡器使用七层协议HTTP/HTTPS时：

-   七层协议HTTP/HTTPS的流量，需要经过LVS集群先将访问请求平均分发到Nginx集群的所有节点，然后Nginx集群的节点再根据负载均衡器的转发策略，将接收到的请求最终分发到后端服务器。
-   七层协议HTTPS的流量，在最终分发到服务器前，还需要在Nginx集群内进行证书验证以及数据包的解密操作。然后通过HTTP协议将请求分发到后端服务器。

## 出网流量路径<a name="section133601141145610"></a>

出网流量遵循请求从哪进来，响应从哪出去的原则。如[出网流量路径](#section133601141145610)所示。

**图 2**  出网流量路径<a name="fig7885192011517"></a>  
![](figures/出网流量路径.png "出网流量路径")

-   通过负载均衡器进入的访问流量，对应的响应流量通过负载均衡器返回。在负载均衡器上限速和计费。由于负载均衡器实际是通过绑定的EIP接收来自公网的流量和响应请求，所以负载均衡器的限制实际是在负载均衡器绑定的EIP 上，并在EIP上进行计费。从负载均衡到后端云服务器之间通过VPC内网进行通信，不收取费用。
-   通过NAT网关进入的访问流量，对应的响应流量通过NAT网关返回。在NAT网关上限速和计费。由于NAT网关实际是通过绑定的EIP接收来自公网的流量和访问公网，所以NAT网关上进行的是连接数的限制，带宽或者流量的限制是在NAT网关绑定的EIP，并分别在NAT网关和弹性公网IP上进行计费。
-   通过EIP进入的访问流量，对应的响应流量通过EIP返回。在EIP上限速和计费。


# 使用访问日志定位异常后端服务器<a name="zh-cn_topic_0168606466"></a>

## 应用场景<a name="section88610314319"></a>

您可以结合云日志服务，通过查看对七层增强型负载均衡进行请求的详细访问日志记录，分析负载均衡的响应状态码，快速定位异常后端服务器。

## 前期准备<a name="section149451307410"></a>

1.  您已经创建了七层负载均衡。
2.  您已经开通了云日志服务。

## 创建日志组<a name="section1234450859"></a>

1.  登录管理控制台。
2.  在管理控制台左上角单击![](figures/zh-cn_image_0168606467.gif)图标，选择区域。

    区域和项目选择“华北-北京一”。

3.  选择“服务列表 \> 管理与部署 \> 云日志服务”。
4.  单击左侧导航栏“日志管理”。
5.  单击 “创建日志组”，在弹出框内，输入日志组名称。

    ![](figures/zh-cn_image_0168606468.png)

6.  单击“确定”，创建完成。

## 创建云日志流<a name="section104683832017"></a>

1.  选择已创建的日志组名称，进入该日志组页面。
2.  单击“创建日志流”，在弹出框内，输入日志流名称。

    ![](figures/截图--日志流.png)

3.  单击“确定”，创建完成。

## 配置访问日志<a name="section173711831719"></a>

1.  选择“服务列表 \> 网络 \> 弹性负载均衡”。
2.  在“负载均衡器”界面，单击需要配置访问日志的负载均衡器名称。
3.  在该负载均衡器界面的“访问日志”页签，单击“配置访问日志”。
4.  开启日志记录，选择您在云日志服务中创建的日志组和日志流。
5.  单击“确定”，配置完成。

>![](public_sys-resources/icon-notice.gif) **须知：**   
>确保创建的云日志组的地域和负载均衡器的地域相同。  

## 查看访问日志<a name="section894011366710"></a>

-   “弹性负载均衡”控制台，进入访问日志界面，即可查看访问日志。

    ![](figures/查看日志截图.png)

-   “云日志服务”控制台，进入日志主题界面，在相应日志流名称所在行，单击“实时查看”或者“搜索日志”，即可查看访问日志。

    ![](figures/zh-cn_image_0168606473.png)


## 定位异常服务器<a name="section53685362811"></a>

筛选异常日志如下：

```
1554944564.344 - [2019-04-11T09:02:44+08:00] elb 10.133.251.171:51527 500 "GET http://10.154.73.58/lrange/guestbook HTTP/1.1" 411 3726 3545 19.028 "500" "0.009" "19.028" "19.028" "100.84.0.82:3000" "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36" "http://10.154.73.58:5971/" "-" loadbalancer_ed0f790b-e194-4657-9f97-53426227099e listener_b21dd0a9-690a-4945-950e-b134095c6bd9 6b6aaf84d72b40fcb2d2b9b28f6a0b83
```

**分析日志：**

在 \[2019-04-11T09:02:44+08:00 时， ELB接收到客户端地址和端口 （10.133.251.171:51527） 发起的 “GET / HTTP/1.1” 请求，ELB将请求转发给后端服务器（100.84.0.82:3000）处理，后端服务器响应状态码500。ELB最终向客户端响应状态码500。

具体字段分析可参照[访问日志](https://support.huaweicloud.com/usermanual-elb/zh-cn_topic_0150301848.html)。

**分析结果：**

后端服务器（100.84.0.82:3000）异常，不能正常响应请求。

请参考[后端服务器](https://support.huaweicloud.com/usermanual-elb/zh-cn_topic_0164706624.html)，排查问题。


# 转发策略<a name="zh-cn_topic_0114694934"></a>

## 操作场景<a name="section79409283156"></a>

增强型负载均衡用户可以通过添加转发策略支持自行设定的域名和URL，将来自不同域名或者不同URL的请求转发到不同的后端服务器组处理。此功能目前仅支持协议类型为HTTP、HTTPS的监听器。

一个监听器最多可添加500条转发策略，您可以将视频、图片、音频、文本等请求分别转发到不同的后端服务器组上去处理，便于灵活的分流业务，合理的分配资源。

在添加了转发策略后，负载均衡器将按以下规则转发前端请求：

-   如果能匹配到监听器的转发策略，则按该转发策略将请求转发到对应的后端服务器组。
-   如果不能匹配到监听器的转发策略，则将请求转发到监听器对应的后端服务器组。

## 添加转发策略<a name="section191183222317"></a>

1.  登录管理控制台。
2.  在管理控制台左上角单击![](figures/zh-cn_image_0114695108.png)图标，选择区域和项目。
3.  选择“服务列表 \> 网络 \> 弹性负载均衡”。
4.  在“负载均衡器”界面，单击需要添加转发策略的负载均衡器名称。
5.  切换到监听器页签，单击目标监听器名称。
6.  单击“转发策略”右侧的“添加”按钮。
7.  在“添加转发策略”弹框中参考[表1](#table10859681016)配置参数。
8.  配置完成，单击“确定”。

    也可在负载均衡器页面单击目标监听器名称，跳转至监听器页面，添加转发策略。


**表 1**  添加转发策略的参数

<a name="table10859681016"></a>
<table><thead align="left"><tr id="row109196141011"><th class="cellrowborder" valign="top" width="9.959999999999999%" id="mcps1.2.5.1.1"><p id="p205701231181017"><a name="p205701231181017"></a><a name="p205701231181017"></a>配置类型</p>
</th>
<th class="cellrowborder" valign="top" width="19.7%" id="mcps1.2.5.1.2"><p id="p69376201010"><a name="p69376201010"></a><a name="p69376201010"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="39.51%" id="mcps1.2.5.1.3"><p id="p294665107"><a name="p294665107"></a><a name="p294665107"></a>说明</p>
</th>
<th class="cellrowborder" valign="top" width="30.830000000000002%" id="mcps1.2.5.1.4"><p id="p119718601010"><a name="p119718601010"></a><a name="p119718601010"></a>样例</p>
</th>
</tr>
</thead>
<tbody><tr id="row141006651018"><td class="cellrowborder" rowspan="5" valign="top" width="9.959999999999999%" headers="mcps1.2.5.1.1 "><p id="p457093112107"><a name="p457093112107"></a><a name="p457093112107"></a>配置转发策略</p>
</td>
<td class="cellrowborder" valign="top" width="19.7%" headers="mcps1.2.5.1.2 "><p id="p171025641010"><a name="p171025641010"></a><a name="p171025641010"></a>名称</p>
</td>
<td class="cellrowborder" valign="top" width="39.51%" headers="mcps1.2.5.1.3 "><p id="p510396141018"><a name="p510396141018"></a><a name="p510396141018"></a>转发策略的名称。</p>
</td>
<td class="cellrowborder" valign="top" width="30.830000000000002%" headers="mcps1.2.5.1.4 "><p id="p5104136141017"><a name="p5104136141017"></a><a name="p5104136141017"></a>forwarding_policy-q582</p>
</td>
</tr>
<tr id="row15105761109"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p2107062104"><a name="p2107062104"></a><a name="p2107062104"></a>域名</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p210718619109"><a name="p210718619109"></a><a name="p210718619109"></a>触发转发的域名，仅支持精确域名。注意，域名或者URL至少要指定一个。</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p4108167108"><a name="p4108167108"></a><a name="p4108167108"></a>www.test.com</p>
</td>
</tr>
<tr id="row16108186101017"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p911056121017"><a name="p911056121017"></a><a name="p911056121017"></a>URL</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p18111176151015"><a name="p18111176151015"></a><a name="p18111176151015"></a>触发转发的URL。</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p511313661015"><a name="p511313661015"></a><a name="p511313661015"></a>/login.php</p>
</td>
</tr>
<tr id="row11113116161018"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p171138691020"><a name="p171138691020"></a><a name="p171138691020"></a>URL匹配规则</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><a name="ul141168619107"></a><a name="ul141168619107"></a><ul id="ul141168619107"><li>精确匹配<p id="p17117367106"><a name="p17117367106"></a><a name="p17117367106"></a>请求的URL和设定URL完全一致。</p>
</li><li>前缀匹配<p id="p1111820611102"><a name="p1111820611102"></a><a name="p1111820611102"></a>请求的URL匹配以设定URL开头的URL。</p>
</li><li>正则匹配<div class="p" id="p1612017621016"><a name="p1612017621016"></a><a name="p1612017621016"></a>请求的URL和设定的URL正则表达式匹配。<div class="note" id="note15121066104"><a name="note15121066104"></a><a name="note15121066104"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p1312111614108"><a name="p1312111614108"></a><a name="p1312111614108"></a>匹配的优先级为：</p>
<p id="p1912226161011"><a name="p1912226161011"></a><a name="p1912226161011"></a>精确匹配&gt;前缀匹配&gt;正则匹配</p>
</div></div>
</div>
</li></ul>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p19123167101"><a name="p19123167101"></a><a name="p19123167101"></a>精确匹配</p>
</td>
</tr>
<tr id="row151292617103"><td class="cellrowborder" valign="top" headers="mcps1.2.5.1.1 "><p id="p413126171017"><a name="p413126171017"></a><a name="p413126171017"></a>描述</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.2 "><p id="p013218618109"><a name="p013218618109"></a><a name="p013218618109"></a>转发策略的描述。</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.5.1.3 "><p id="p213376191011"><a name="p213376191011"></a><a name="p213376191011"></a>-</p>
</td>
</tr>
<tr id="row2079614577109"><td class="cellrowborder" valign="top" width="9.959999999999999%" headers="mcps1.2.5.1.1 "><p id="p7796857121015"><a name="p7796857121015"></a><a name="p7796857121015"></a>添加后端服务器组</p>
</td>
<td class="cellrowborder" valign="top" width="19.7%" headers="mcps1.2.5.1.2 "><p id="p19796145771015"><a name="p19796145771015"></a><a name="p19796145771015"></a>后端服务器组</p>
</td>
<td class="cellrowborder" valign="top" width="39.51%" headers="mcps1.2.5.1.3 "><p id="p1679615710102"><a name="p1679615710102"></a><a name="p1679615710102"></a>可选择“新创建”或“使用已有”。选择“新创建”，可参考<a href="添加或移除后端服务器（增强型）.md#zh-cn_topic_0091131437_table83118104911">表1</a>和<a href="添加或移除后端服务器（增强型）.md#zh-cn_topic_0091131437_table736610293">表2</a>进行参数配置。选择“使用已有”，为转发策略选择已有的后端服务器组即可。</p>
<div class="note" id="note085961618274"><a name="note085961618274"></a><a name="note085961618274"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p13859616142716"><a name="p13859616142716"></a><a name="p13859616142716"></a>后端协议只能选择HTTP。</p>
</div></div>
</td>
<td class="cellrowborder" valign="top" width="30.830000000000002%" headers="mcps1.2.5.1.4 "><p id="p87961057131011"><a name="p87961057131011"></a><a name="p87961057131011"></a>新创建</p>
</td>
</tr>
</tbody>
</table>

## URL匹配示例<a name="section19645182316511"></a>

如[表2](#table5831113119590)所示，是一个URL匹配示例，转发情况如[图1](#fig87121434403)所示。

**表 2**  URL匹配示例

<a name="table5831113119590"></a>
<table><thead align="left"><tr id="row4697541666"><th class="cellrowborder" valign="top" id="mcps1.2.7.1.1"><p id="p669813413615"><a name="p669813413615"></a><a name="p669813413615"></a>模式</p>
</th>
<th class="cellrowborder" valign="top" id="mcps1.2.7.1.2"><p id="p969884114610"><a name="p969884114610"></a><a name="p969884114610"></a>请求URL</p>
</th>
<th class="cellrowborder" colspan="4" valign="top" id="mcps1.2.7.1.3"><p id="p193919591169"><a name="p193919591169"></a><a name="p193919591169"></a>设定URL</p>
</th>
</tr>
</thead>
<tbody><tr id="row1289643195912"><td class="cellrowborder" valign="top" width="15.933186637327465%" headers="mcps1.2.7.1.1 "><p id="p17134761873"><a name="p17134761873"></a><a name="p17134761873"></a>-</p>
</td>
<td class="cellrowborder" valign="top" width="18.81376275255051%" headers="mcps1.2.7.1.2 "><p id="p17134567713"><a name="p17134567713"></a><a name="p17134567713"></a>-</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.2.7.1.3 "><p id="p1089663175919"><a name="p1089663175919"></a><a name="p1089663175919"></a>/elb/index.html</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.2.7.1.3 "><p id="p6896113175915"><a name="p6896113175915"></a><a name="p6896113175915"></a>/elb</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.2.7.1.3 "><p id="p1689673113599"><a name="p1689673113599"></a><a name="p1689673113599"></a>/elb[^\s]*</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.2.7.1.3 "><p id="p3896731205919"><a name="p3896731205919"></a><a name="p3896731205919"></a>/index.html</p>
</td>
</tr>
<tr id="row2896103116597"><td class="cellrowborder" valign="top" width="15.933186637327465%" headers="mcps1.2.7.1.1 "><p id="p1689783116593"><a name="p1689783116593"></a><a name="p1689783116593"></a>精确匹配</p>
</td>
<td class="cellrowborder" rowspan="3" valign="top" width="18.81376275255051%" headers="mcps1.2.7.1.2 "><p id="p118978317599"><a name="p118978317599"></a><a name="p118978317599"></a>/elb/index.html</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.2.7.1.3 "><p id="p38975312592"><a name="p38975312592"></a><a name="p38975312592"></a>√</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.2.7.1.3 "><p id="p17897103116599"><a name="p17897103116599"></a><a name="p17897103116599"></a>-</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.2.7.1.3 "><p id="p289713114590"><a name="p289713114590"></a><a name="p289713114590"></a>-</p>
</td>
<td class="cellrowborder" valign="top" width="16.313262652530504%" headers="mcps1.2.7.1.3 "><p id="p1189733155917"><a name="p1189733155917"></a><a name="p1189733155917"></a>-</p>
</td>
</tr>
<tr id="row198979312599"><td class="cellrowborder" valign="top" headers="mcps1.2.7.1.1 "><p id="p7897103195912"><a name="p7897103195912"></a><a name="p7897103195912"></a>前缀匹配</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.7.1.2 "><p id="p989713315591"><a name="p989713315591"></a><a name="p989713315591"></a>√</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.7.1.3 "><p id="p1589763110598"><a name="p1589763110598"></a><a name="p1589763110598"></a>√</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.7.1.3 "><p id="p1489753118593"><a name="p1489753118593"></a><a name="p1489753118593"></a>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.7.1.3 "><p id="p18897183115599"><a name="p18897183115599"></a><a name="p18897183115599"></a>-</p>
</td>
</tr>
<tr id="row18971031195914"><td class="cellrowborder" valign="top" headers="mcps1.2.7.1.1 "><p id="p13897631125920"><a name="p13897631125920"></a><a name="p13897631125920"></a>正则匹配</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.7.1.2 "><p id="p289715311594"><a name="p289715311594"></a><a name="p289715311594"></a>√</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.7.1.3 "><p id="p11897173105916"><a name="p11897173105916"></a><a name="p11897173105916"></a>-</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.7.1.3 "><p id="p489714312592"><a name="p489714312592"></a><a name="p489714312592"></a>√</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.7.1.3 "><p id="p10897731155915"><a name="p10897731155915"></a><a name="p10897731155915"></a>-</p>
</td>
</tr>
</tbody>
</table>

**图 1**  转发示例<a name="fig87121434403"></a>  
![](figures/转发示例.jpg "转发示例")

以上图为例

请求的URL：/elb\_gls/glossary.html先在精确匹配规则中查找，如果没有找到精确匹配的规则，则继续在前缀匹配规则中查找，找到匹配的规则2，将该请求转发到规则2对应的后端服务器组2。此时虽然请求URL和正则匹配规则中的规则3相匹配，但由于前缀匹配的优先级比较高，所以最终将请求转发至后端服务器组2。

## 修改转发策略<a name="section0239201242216"></a>

1.  登录管理控制台。
2.  在管理控制台左上角单击![](figures/zh-cn_image_0155033570.png)图标，选择区域和项目。
3.  选择“服务列表 \> 网络 \> 弹性负载均衡”。
4.  在“负载均衡器”界面，单击需要修改转发策略的负载均衡器名称。
5.  切换到监听器页签，单击需要修改转发策略的监听器名称。
6.  单击“转发策略”。
7.  单击目标转发策略名称右侧的![](figures/zh-cn_image_0155041158.png)。
8.  在弹出的“修改转发策略”对话框中，修改参数，单击“确认”。

## 删除转发策略<a name="section4306132117396"></a>

1.  登录管理控制台。
2.  在管理控制台左上角单击![](figures/zh-cn_image_0121143837.png)图标，选择区域和项目。
3.  选择“服务列表 \> 网络 \> 弹性负载均衡”。
4.  在“负载均衡器”界面，单击需要删除转发策略的负载均衡器名称。
5.  切换到监听器页签，单击需要删除转发策略的监听器名称。
6.  单击“转发策略”。
7.  单击目标转发策略名称右侧的![](figures/zh-cn_image_0155036235.png)。
8.  在弹出的“删除转发策略”对话框中，单击“是”，删除转发策略。

